<div id="admin-content">
      <div class="container">
          <div class="row">
              <div class="col-md-10">
                <h1 class="admin-heading"><i class="fa fa-users"></i> All Users</h1>
              </div>
              <div class="col-md-2">
                <a class="add-new" href="/admin/add-user">add user</a>
              </div>
              <div class="col-md-12">
               
              <div id="usersTable"></div>
               
              </div>
          </div>
      </div>
  </div>

  <!-- Tabulator JS -->
<script src="https://cdn.jsdelivr.net/npm/tabulator-tables@6.3.1/dist/js/tabulator.min.js"></script>

<script>
const tableData = <%- JSON.stringify(users) %>;
var table = new Tabulator("#usersTable", {
    data: tableData,
    layout: "fitColumns",
    pagination: true,
    paginationSize: 10,
    paginationSizeSelector: [5, 10, 25, 50, 100],
    columns: [
       {title : "S.No", formatter:"rownum", hozAlign:"center", width:100},
        { title: "Full Name", field: "fullname", headerFilter: "input" },
        { title: "User Name", field: "username", headerFilter: "input" },
        { title: "Role", field: "role", headerFilter: "input" },
        {
            title: "Actions",
            formatter: function (cell, formatterParams, onRendered) {

                const id = cell.getData()._id; 

                return `
                    <a href="/admin/update-user/${id}" class="btn btn-sm btn-success">Edit</a>
                    <button class="btn btn-sm btn-danger" onclick="deleteUser('${id}')">Delete</button>
                `;
            }
        }
    ]
});


//Delete User Function


async function deleteUser(id) {
  if (!confirm("Are you sure you want to delete this user?")) return;

  try {
    const response = await fetch(`/admin/delete-user/${id}`, {
      method: 'DELETE'
    });

    const data = await response.json();

    // ðŸ”´ Handle error statuses (400, 404, 409, etc.)
    if (!response.ok) {
      alert(data.message);   // backend decides message
      return;
    }

    // âœ… Success
    alert(data.message);     // "User deleted successfully"
    location.reload();

  } catch (error) {
    console.error('Error deleting user:', error);
    alert("Server error");
  }
}


//  function deleteUser(id) {
//     try {
//         if (confirm("Are you sure you want to delete this user?")) {
//             fetch(`/admin/delete-user/${id}`, {
//                 method: 'DELETE',
//             })
//             .then(response => response.json())
//             .then(data => {
//                 if (data.success) {
//                     alert("User deleted successfully");
//                     location.reload(); 
//                 } else {
//                     alert("Failed to delete user");
//                 }
//             })
//             .catch(error => {
//                 console.error('Error deleting user:', error);
//             });
//         }
//     } catch (error) {
//         console.error('Error deleting user:', error);
//     }
// }


</script>

 <%- contentFor('tabulatorCSS') %>
 <!-- Tabulator CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tabulator-tables@6.3.1/dist/css/tabulator.min.css">